(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3acc4986"],{"498a":function(e,t,r){"use strict";var n=r("23e7"),i=r("58a8").trim,s=r("c8d2");n({target:"String",proto:!0,forced:s("trim")},{trim:function(){return i(this)}})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var n=r("1d80"),i=r("5899"),s="["+i+"]",a=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),o=function(e){return function(t){var r=String(n(t));return 1&e&&(r=r.replace(a,"")),2&e&&(r=r.replace(c,"")),r}};e.exports={start:o(1),end:o(2),trim:o(3)}},"67f7":function(e,t,r){"use strict";r("ef04")},"8e2a":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"Message"}},[r("article",{staticClass:"title"},[r("h2",[e._v("留言板")]),r("p",[e._v("请文明发言，禁止广告。不然拉黑了嗷\\(^o^)/~")]),r("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容",maxlength:"100","show-word-limit":""},model:{value:e.textarea,callback:function(t){e.textarea=t},expression:"textarea"}}),r("div",{staticClass:"btn"},[r("i",{staticClass:"iconfont icon-biaoqing",on:{click:function(t){return t.stopPropagation(),e.handleToggleEmoji(t)}}}),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleMsgSubmit}},[e._v("发表 ")]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.showEmoji,expression:"showEmoji"}],staticClass:"emoji",on:{click:function(e){e.stopPropagation()}}},[r("ul",e._l(e.emoji,(function(t){return r("li",{on:{click:function(r){return e.handleEmojiClick(t)}}},[e._v(" "+e._s(t)+" ")])})),0)]),r("div",{staticClass:"clear"})],1)],1),r("article",{staticClass:"content"},[r("ul",e._l(e.msgData,(function(t){return r("li",[r("div",{staticClass:"parent"},[r("div",{staticClass:"left"},[r("img",{attrs:{src:e.urlBase+t.user.face,alt:""}})]),r("div",{staticClass:"right"},[r("div",{staticClass:"name-time"},[r("span",[e._v(e._s(t.user.user))]),r("span",[e._v(e._s(e._f("fmtTime")(t.time)))])]),r("div",{staticClass:"message"},[e._v(" "+e._s(t.msg)+" ")]),r("div",{staticClass:"like-reply"},[r("i",{staticClass:"like iconfont icon-xinaixin",class:{isLike:-1!==t.likes.indexOf(e.userInfo._id)},on:{click:function(r){return e.handleLikesClick(t,t)}}}),r("span",[e._v(e._s(t.likes.length))]),r("i",{staticClass:"reply iconfont icon-huifu",on:{click:function(r){return e.handleReplyClick(t,t)}}})])])]),e._l(t.children,(function(n,i){return r("div",{staticClass:"child"},[r("div",{staticClass:"left"},[r("img",{attrs:{src:e.urlBase+n.user.face,alt:""}})]),r("div",{staticClass:"right"},[r("div",{staticClass:"name-time"},[r("span",[e._v(e._s(n.user.user))]),r("span",[e._v(e._s(e._f("fmtTime")(n.time)))])]),r("div",{staticClass:"message"},[r("span",[e._v("@"+e._s(n.reply.user))]),e._v(" "+e._s(n.msg)+" ")]),r("div",{staticClass:"like-reply"},[r("i",{staticClass:"like iconfont icon-xinaixin",class:{isLike:-1!==n.likes.indexOf(e.userInfo._id)},on:{click:function(r){return e.handleLikesClick(t,n,i)}}}),r("span",[e._v(e._s(n.likes.length))]),r("i",{staticClass:"reply iconfont icon-huifu",on:{click:function(r){return e.handleReplyClick(t,n)}}})])])])})),r("div",{staticClass:"replyInput",class:{show:t.isShowReply}},[r("el-input",{attrs:{placeholder:"@"+t.replyUser.user,size:"mini"},model:{value:t.replyTxt,callback:function(r){e.$set(t,"replyTxt",r)},expression:"item.replyTxt"}}),r("el-button",{staticClass:"replyBtn",attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.handleReplyInputClick(t)}}},[e._v("回复 ")]),r("div",{staticClass:"clear"})],1)],2)})),0)])])},i=[],s=r("1da1"),a=r("5530"),c=(r("96cf"),r("498a"),r("4de4"),r("a434"),r("2f62")),o={name:"Message",data:function(){return{textarea:"",showEmoji:!1,emoji:["😃","😁","😂","😊","🙃","🥰","😘","🤭","🤔","😏","😵","😟","🙁","😳","😰","😭","😖","😡","😠","😈","🤡","☠️","👻","🙈","🙉","❤️","💖","💢","💣","💤","👋","👍","👌","🤞","🤟","🤙","👊","🖕","🤝","🙏","🙅","🙅‍♂️","👨‍✈️","👩‍✈️","👷","👷‍♀️","🤦","🤦‍♂️","👴","🧓","🐴","🐮","🐖","🐑","🐓","🦚","🐲","🐳","🐟","🐌"],msgData:[]}},computed:Object(a["a"])({},Object(c["c"])(["userInfo"])),methods:{handleToggleEmoji:function(){this.showEmoji=!this.showEmoji},handleEmojiClick:function(e){this.textarea+=e,this.showEmoji=!1},handleMsgSubmit:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.textarea.trim(),n=e.userInfo._id,n){t.next=4;break}return t.abrupt("return",e.$message.error("请先登录"));case 4:if(r){t.next=6;break}return t.abrupt("return",e.$message.error("请先输入留言内容"));case 6:return t.next=8,e.$axios({method:"post",url:"/msg",data:{msg:r,userId:n}});case 8:if(i=t.sent,s=i.data,0===s.code){t.next=12;break}return t.abrupt("return",e.$message.error(s.msg));case 12:e.$message({type:"success",message:"留言发表成功",duration:1e3,onClose:function(){window.location.reload()}});case 13:case"end":return t.stop()}}),t)})))()},getMsgList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios({method:"get",url:"/msg"});case 2:r=t.sent,n=r.data.data,n.filter((function(e){e.replyTxt="",e.replyUser=Object(a["a"])({},e.user),e.isShowReply=!1})),e.msgData=n;case 6:case"end":return t.stop()}}),t)})))()},handleLikesClick:function(e,t,r){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var s,a,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(s=n.userInfo._id,s){i.next=3;break}return i.abrupt("return",n.$message.error("请先登录"));case 3:return a=t.likes,c=a.indexOf(s),-1!==c?a.splice(c,1):a.push(s),i.next=8,n.$axios({method:"post",url:"/msg/like",data:{parentId:e._id,childId:t._id,likes:a,childIndex:r}});case 8:case"end":return i.stop()}}),i)})))()},handleReplyClick:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.user._id!==e.replyUser._id||!e.isShowReply){r.next=3;break}return e.isShowReply=!1,r.abrupt("return");case 3:e.replyUser=t.user,e.isShowReply=!0;case 5:case"end":return r.stop()}}),r)})))()},handleReplyInputClick:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,i,s,a,c,o,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.replyTxt.trim(),i=t.userInfo._id,s=e.replyUser._id,n){r.next=5;break}return r.abrupt("return",t.$message.error("请先输入回复内容"));case 5:if(i){r.next=7;break}return r.abrupt("return",t.$message.error("请先登录！"));case 7:return a=e._id,c={msg:n,user:i,reply:s},r.next=10,t.$axios({method:"post",url:"/msg/reply",data:{msgId:a,child:c}});case 10:if(o=r.sent,l=o.data,0===l.code){r.next=14;break}return r.abrupt("return",t.$message.error(l.code));case 14:t.$message({type:"success",message:"回复成功",duration:1e3,onClose:function(){window.location.reload()}});case 15:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;document.addEventListener("click",(function(){e.showEmoji=!1})),this.getMsgList()}},l=o,u=(r("67f7"),r("2877")),d=Object(u["a"])(l,n,i,!1,null,"5353171c",null);t["default"]=d.exports},a434:function(e,t,r){"use strict";var n=r("23e7"),i=r("23cb"),s=r("a691"),a=r("50c4"),c=r("7b0b"),o=r("65f0"),l=r("8418"),u=r("1dde"),d=u("splice"),f=Math.max,p=Math.min,m=9007199254740991,h="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,n,u,d,g,v,k=c(this),x=a(k.length),w=i(e,x),_=arguments.length;if(0===_?r=n=0:1===_?(r=0,n=x-w):(r=_-2,n=p(f(s(t),0),x-w)),x+r-n>m)throw TypeError(h);for(u=o(k,n),d=0;d<n;d++)g=w+d,g in k&&l(u,d,k[g]);if(u.length=n,r<n){for(d=w;d<x-n;d++)g=d+n,v=d+r,g in k?k[v]=k[g]:delete k[v];for(d=x;d>x-n+r;d--)delete k[d-1]}else if(r>n)for(d=x-n;d>w;d--)g=d+n-1,v=d+r-1,g in k?k[v]=k[g]:delete k[v];for(d=0;d<r;d++)k[d+w]=arguments[d+2];return k.length=x-n+r,u}})},c8d2:function(e,t,r){var n=r("d039"),i=r("5899"),s="​᠎";e.exports=function(e){return n((function(){return!!i[e]()||s[e]()!=s||i[e].name!==e}))}},ef04:function(e,t,r){}}]);
//# sourceMappingURL=chunk-3acc4986.ff33873c.js.map