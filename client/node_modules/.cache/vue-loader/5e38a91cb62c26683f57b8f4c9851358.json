{"remainingRequest":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nile/study/myProject/blog/开发版本/client/src/views/UserInfo.vue?vue&type=style&index=0&id=10c844d3&scoped=true&lang=less&","dependencies":[{"path":"/Users/nile/study/myProject/blog/开发版本/client/src/views/UserInfo.vue","mtime":1615211792000},{"path":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nile/study/myProject/blog/开发版本/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQojVXNlckluZm8gew0KICBhcnRpY2xlIHsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIHdpZHRoOiAxMDAlOw0KICAgIG1hcmdpbi1ib3R0b206IDE1cHg7DQogICAgYm94LXNoYWRvdzogMCAwIDRweCAjZGRkOw0KICAgIHBhZGRpbmc6IDI1cHggMjBweDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIGZvbnQtZmFtaWx5OiAiUXVpY2tzYW5kIiwgIk1pY3Jvc29mdCBZYUhlaSIsIHNhbnMtc2VyaWY7DQoNCiAgICBoMiB7DQogICAgICBtYXJnaW4tYm90dG9tOiAxNXB4Ow0KICAgICAgZm9udC1zaXplOiAyMHB4Ow0KICAgICAgbGV0dGVyLXNwYWNpbmc6IDNweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAyNHB4Ow0KICAgICAgYm9yZGVyLWxlZnQ6IDVweCBzb2xpZCAjNzNiODk5Ow0KICAgICAgdGV4dC1pbmRlbnQ6IDEwcHg7DQogICAgfQ0KDQogICAgcCB7DQogICAgICB0ZXh0LWluZGVudDogMmVtOw0KICAgICAgY29sb3I6ICM0NDQ7DQogICAgICBmb250LXNpemU6IDE0cHg7DQogICAgICBsZXR0ZXItc3BhY2luZzogNHB4Ow0KICAgICAgbGluZS1oZWlnaHQ6IDMwcHg7DQoNCiAgICAgIGEgew0KICAgICAgICBjb2xvcjogIzQwOWVmZjsNCg0KICAgICAgICAmOmhvdmVyIHsNCiAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBzcGFuLmltZyB7DQogICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgICAgd2lkdGg6IDQwcHg7DQogICAgICAgIGhlaWdodDogNDBweDsNCiAgICAgICAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjsNCiAgICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAudGhpcmQgew0KICAgIC9kZWVwLyAuYXZhdGFyLXVwbG9hZGVyIC5lbC11cGxvYWQgew0KICAgICAgYm9yZGVyOiAxcHggZGFzaGVkICNkOWQ5ZDk7DQogICAgICBib3JkZXItcmFkaXVzOiA2cHg7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIH0NCiAgICAvZGVlcC8gLmF2YXRhci11cGxvYWRlciAuZWwtdXBsb2FkOmhvdmVyIHsNCiAgICAgIGJvcmRlci1jb2xvcjogIzQwOUVGRjsNCiAgICB9DQogICAgL2RlZXAvIC5hdmF0YXItdXBsb2FkZXItaWNvbiB7DQogICAgICBmb250LXNpemU6IDI4cHg7DQogICAgICBjb2xvcjogIzhjOTM5ZDsNCiAgICAgIHdpZHRoOiAxNzhweDsNCiAgICAgIGhlaWdodDogMTc4cHg7DQogICAgICBsaW5lLWhlaWdodDogMTc4cHg7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgfQ0KICAgIC9kZWVwLyAuYXZhdGFyIHsNCiAgICAgIHdpZHRoOiAxNzhweDsNCiAgICAgIGhlaWdodDogMTc4cHg7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICB9DQogIH0NCg0KfQ0KDQo="},{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"UserInfo.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div id=\"UserInfo\">\r\n    <article v-if=\"userInfo._id\">\r\n      <h2>用户信息</h2>\r\n      <p>昵称：{{ userInfo.user }}</p>\r\n      <p>\r\n        头像：\r\n        <span\r\n          class=\"img\"\r\n          :style=\"{\r\n            backgroundImage: `url(${urlBase}${userInfo.face})`\r\n          }\"\r\n        ></span>\r\n      </p>\r\n      <div class=\"update\">\r\n        <el-tabs v-model=\"activeName\">\r\n          <el-tab-pane label=\"修改昵称\" name=\"first\">\r\n            <el-form\r\n              :model=\"nameForm\"\r\n              status-icon\r\n              :rules=\"rules\"\r\n              ref=\"nameForm\"\r\n              label-width=\"100px\"\r\n            >\r\n              <el-form-item label=\"原昵称\">\r\n                {{ userInfo.user }}\r\n              </el-form-item>\r\n              <el-form-item label=\"新昵称\" prop=\"user\">\r\n                <el-input\r\n                  type=\"text\"\r\n                  v-model=\"nameForm.user\"\r\n                  autocomplete=\"off\"\r\n                ></el-input>\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" @click=\"handleNameUpdate('nameForm')\">确认修改</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"修改密码\" name=\"second\">\r\n            <el-form\r\n              :model=\"passForm\"\r\n              status-icon\r\n              :rules=\"rules\"\r\n              ref=\"passForm\"\r\n              label-width=\"100px\"\r\n            >\r\n              <el-form-item label=\"原密码\" prop=\"oldPass\">\r\n                <el-input\r\n                  type=\"password\"\r\n                  v-model=\"passForm.oldPass\"\r\n                  autocomplete=\"off\"\r\n                ></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"新密码\" prop=\"newPass\">\r\n                <el-input\r\n                  type=\"password\"\r\n                  v-model=\"passForm.newPass\"\r\n                  autocomplete=\"off\"\r\n                ></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"确认新密码\" prop=\"newPass2\">\r\n                <el-input\r\n                  type=\"password\"\r\n                  v-model=\"passForm.newPass2\"\r\n                  autocomplete=\"off\"\r\n                ></el-input>\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" @click=\"handlePassUpdate('passForm')\">确认修改</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"修改头像\" class=\"third\" name=\"third\">\r\n            <el-upload\r\n              class=\"avatar-uploader\"\r\n              name=\"avatar\"\r\n              :action=\"urlBase+'/upload/face'\"\r\n              :show-file-list=\"false\"\r\n              :with-credentials=\"true\"\r\n              :on-success=\"handleAvatarSuccess\"\r\n              :before-upload=\"beforeAvatarUpload\">\r\n              <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\r\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n            </el-upload>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n    </article>\r\n    <article v-else>\r\n      <h2>用户信息</h2>\r\n      <p>暂未登陆，无信息。\r\n        <router-link to=\"/\">返回首页</router-link>\r\n      </p>\r\n    </article>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {mapState} from \"vuex\"\r\n\r\nexport default {\r\n  name: \"UserInfo\",\r\n  data() {\r\n    return {\r\n      urlBase: process.env.NODE_ENV === \"development\" ? \"http://localhost:3000\" : \"\"\r\n      , activeName: \"first\"\r\n      , nameForm: {user: \"\"}\r\n      , passForm: {\r\n        oldPass: \"\",\r\n        newPass: \"\",\r\n        newPass2: \"\"\r\n      }\r\n      , rules: {\r\n        /*用户名规则*/\r\n        user: [{\r\n          validator(rule, value, callback) {\r\n            if (/^[\\w\\u4e00-\\u9fa5]{2,8}$/.test(value)) {\r\n              callback()\r\n            } else {\r\n              callback(new Error(\"用户名不满足规则\"))\r\n            }\r\n          },\r\n          required: true,\r\n          trigger: \"blur\"\r\n        }],\r\n\r\n        /*密码规则*/\r\n        oldPass: [{\r\n          validator(rule, value, callback) {\r\n            if (/^[\\w\\[\\]\\/\\\\\\-!@#$%^&*()+=|,.<>?:;\"'{}]{6,18}$/.test(value)) {\r\n              callback()\r\n            } else {\r\n              callback(new Error(\"密码不满足规则\"))\r\n            }\r\n          },\r\n          required: true,\r\n          trigger: \"blur\"\r\n        }],\r\n        newPass: [{\r\n          validator(rule, value, callback) {\r\n            if (/^[\\w\\[\\]\\/\\\\\\-!@#$%^&*()+=|,.<>?:;\"'{}]{6,18}$/.test(value)) {\r\n              callback()\r\n            } else {\r\n              callback(new Error(\"密码不满足规则\"))\r\n            }\r\n          },\r\n          required: true,\r\n          trigger: \"blur\"\r\n        }],\r\n        /*再次输入密码规则*/\r\n        newPass2: [{\r\n          validator: (rule, value, callback) => {\r\n            if (value === this.passForm.newPass) {\r\n              callback()\r\n            } else {\r\n              callback(\"两次输入密码不一致\")\r\n            }\r\n          },\r\n          required: true,\r\n          trigger: \"blur\"\r\n        }]\r\n\r\n      }\r\n      , imageUrl: \"\"\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['userInfo'])\r\n  },\r\n  methods: {\r\n    //修改昵称\r\n    handleNameUpdate(formName) {\r\n      this.$refs[formName].validate(async valid => {\r\n        if (!valid)return false\r\n        let {data} = await this.$axios({\r\n          method: \"post\",\r\n          url: \"/update/name\",\r\n          data: {newName: this.nameForm.user}\r\n        })\r\n\r\n        if (data.code !== 0){\r\n          return this.$message.error(data.msg)\r\n        }\r\n\r\n        this.$message({\r\n          type: \"success\",\r\n          duration: 1000,\r\n          message: \"更新成功\",\r\n          onClose(){\r\n            window.location.reload()\r\n          }\r\n        })\r\n\r\n      })\r\n    },\r\n\r\n    //修改密码\r\n    handlePassUpdate(formName){\r\n      this.$refs[formName].validate(async valid => {\r\n        if (!valid)return false\r\n        let {data} = await this.$axios({\r\n          method: \"post\",\r\n          url: \"/update/pass\",\r\n          data: {\r\n            _id: this.userInfo._id,\r\n            oldPass: this.passForm.oldPass,\r\n            newPass: this.passForm.newPass\r\n          }\r\n        })\r\n\r\n        console.log(data);\r\n\r\n      })\r\n    },\r\n\r\n    //上传成功之后\r\n    handleAvatarSuccess(res, file) {\r\n      if (res.code !== 0){\r\n        return this.$message.error(res.msg)\r\n      }\r\n      this.imageUrl = URL.createObjectURL(file.raw);\r\n      this.$message({\r\n        type: \"success\",\r\n        message: \"上传成功\",\r\n        duration: 1000,\r\n        onClose(){\r\n          window.location.reload()\r\n        }\r\n      })\r\n    },\r\n    //上传之后的检测\r\n    beforeAvatarUpload(file) {\r\n      //是否是图片格式\r\n      let isImage = /^image\\/(gif|jpeg|png)$/.test(file.type)\r\n      //是否小于2M\r\n      let isLt2M = file.size / 1024 / 1024 < 2;\r\n      if (!isImage) {\r\n        this.$message.error('上传头像必须是jpg/png/gif图片');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isImage && isLt2M\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n#UserInfo {\r\n  article {\r\n    box-sizing: border-box;\r\n    width: 100%;\r\n    margin-bottom: 15px;\r\n    box-shadow: 0 0 4px #ddd;\r\n    padding: 25px 20px;\r\n    background-color: #fff;\r\n    font-family: \"Quicksand\", \"Microsoft YaHei\", sans-serif;\r\n\r\n    h2 {\r\n      margin-bottom: 15px;\r\n      font-size: 20px;\r\n      letter-spacing: 3px;\r\n      line-height: 24px;\r\n      border-left: 5px solid #73b899;\r\n      text-indent: 10px;\r\n    }\r\n\r\n    p {\r\n      text-indent: 2em;\r\n      color: #444;\r\n      font-size: 14px;\r\n      letter-spacing: 4px;\r\n      line-height: 30px;\r\n\r\n      a {\r\n        color: #409eff;\r\n\r\n        &:hover {\r\n          text-decoration: underline;\r\n        }\r\n      }\r\n\r\n      span.img {\r\n        display: inline-block;\r\n        width: 40px;\r\n        height: 40px;\r\n        background-size: cover;\r\n        background-position: center center;\r\n      }\r\n    }\r\n  }\r\n\r\n  .third {\r\n    /deep/ .avatar-uploader .el-upload {\r\n      border: 1px dashed #d9d9d9;\r\n      border-radius: 6px;\r\n      cursor: pointer;\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    /deep/ .avatar-uploader .el-upload:hover {\r\n      border-color: #409EFF;\r\n    }\r\n    /deep/ .avatar-uploader-icon {\r\n      font-size: 28px;\r\n      color: #8c939d;\r\n      width: 178px;\r\n      height: 178px;\r\n      line-height: 178px;\r\n      text-align: center;\r\n    }\r\n    /deep/ .avatar {\r\n      width: 178px;\r\n      height: 178px;\r\n      display: block;\r\n    }\r\n  }\r\n\r\n}\r\n\r\n</style>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}]}